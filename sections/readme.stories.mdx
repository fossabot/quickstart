import { Meta } from '@storybook/addon-docs/blocks';
import {LinkList} from '../components/LinkList/LinkList.tsx'
import {Tip} from '../components/Tip/Tip.tsx'

<Meta title="Introduction" />

# Welcome

## What is this project

This is a proof of concept front-end put together to showcase a fully-modernised
developer experience. It uses:

- Typescript for type-safe JS
- CSS Modules for scope-safe CSS
- Tailwind for generic css
- Next.js for SSR react
- React for components
- Jest for unit testing
- Cypress for integration testing
- Storybook for documentation
- Next-Auth for authentication
- Next-Images for image optimisation
- Next-Offline with Expo for PWA generation and React Native support
- Next-Translate for multilanguage support
- Stylelint, ESLint and Prettier for linting and code style
- Vercel for CDN and Deploying

## Project Layout

Next.js has an amazing, file-system based routing system.
The problem is that keeping tests, stylesheets, etc together with
their respective components is an easy way to help manage technical debt,
but Next doesn't like it much when we have tons of files in these routing folders!

To address this, we keep our sources and our routing seperate, and connect
them with files and exports. This layout allows Next.js page files to be 
co-located with their dependencies!

Think of `/sections/` as our "pages" or "templates" folder.
We then point to these pages using files inside Next.js's `/pages/` folder.

Sections are made up of components, which naturally are found in the `/components/` folder.
Components are re-usable, fully tested chunks of code with predicable behaviour.

Next.js also has amazing support for serverless functions, which are great for handling
one-off odd jobs or transforming and validating data.

We also want to keep our tests and other files co-located with our API endoints, so we store
our actual endpoint code inside `/interfaces/`, and just like with Pages and Sections we point them
with files inside `/api/`, so that Next.js can use them.

We also want to make supporting multilanguage an option moving forward, so we use
i18next to deliver text content. Not only does this make text re-usable and easy to update,
it also means that supporting another language is a synch. We can simply copy the `/locales/en`
folder, send it off for translation, and then paste it at `/locales/cy`. Now we have can support
Welsh speaking users!

### What goes where?

- Global styles can be found in in `/sections/styles.css`
- Components go in the `/components/{component}/{files}` folder
- Pages go in the `/sections/{section}/{files}` folder
- API Endpoints go in the `/interface/{endpoint}` folder
- Routing is handled by creating a pointer file inside `/pages` or `/pages/api`
- Images and assets go in `/{component|section}/assets/{files}` or `/public/assets/{files}` or
- Localisations are automatically extracted and stored at `/locales/{languageCode}/{namespace}.json`
- Documentation and stories are stored as `/{component|interface}/{component|interface}.stories.tsx`
- Unit tests (jest & react-testing-library) are stored as `/{component|interface}/{component|interface}.test.tsx`
- E2E tests (cypress) are stored as `/{section|interface}/{section|interface}.spec.tsx`

## Getting set-up

To get started, you need a local copy of our codebase.
Open a command line, and navigate to an easy to access location,
like `C:\projects` on Windows or `~/projects` on MacOS.

Then run this command to get a local copy of the project:
```bash
git clone {url}
cd ./project
```

Next, you're going to need to get set up with our developer environment.

- Install [NodeJS](https://nodejs.org/en/download/)
- Install [Yarn](https://yarnpkg.com/getting-started/install)
- Install [VSCode](https://code.visualstudio.com/)
- Add the recommended extensions to get VSCode set up quickly, or pick and choose the ones you want.

Now that you are set up, launch the developer environment with:
```bash
yarn start
```
You can cancel out of this at any time by mashing <kbd>ctrl+c</kbd> on Windows or <kbd>cmd+c</kbd> on MacOS

<Tip label="Note">
  We'll automatically check and install dependencies when you run `yarn start` to make your life easier.
</Tip>

## Building components

Once you've got set up and are ready to start developing components, it might be worth looking through these videos to help understand the tools and philosophy of our development process.

<LinkList links={[
  {
    href: "https://www.youtube.com/watch?v=SWYqp7iY_Tc",
    title: "Using Git and Github",
    description: 'Traversy Media: In this Git tutorial we will talk about what exactly Git is and we will look at and work with all of the basic and most important commands such as add, commit, status, push and more. This tutorial is very beginner friendly.'
  },
  {
    href: "https://www.youtube.com/watch?v=kCR3JAR7CHE",
    title: "Test Driven Development (TDD) with Jest",
    description: 'Kent C. Dodds: Follow along with this stream, introducing you to TDD with React powered by Jest and react-testing-library'
  },
  {
    href: "https://www.youtube.com/watch?v=p2sZKAPOQXs",
    title: "Design Driven Development (DDD) with Storybook",
    description: 'Headway: Learn how to make building beautiful UI from Figma to React in an organized and efficient way for your team. Walk through how you can begin to assemble a Storybook design system using components from Figma to React.'
  },
  {
    href: "https://www.youtube.com/watch?v=6zIuAyLZPH0",
    title: "Style your component with Tailwind",
    description: 'Scotch.io: Tailwind CSS is a utility framework that may be different than other CSS frameworks you may be used to. We\'ll explore why Tailwind CSS is a great way to think about your CSS and how it differs from Bootstrap. We will compare Bootstrap cards and buttons vs Tailwind to see how we can build faster with Tailwind CSS.'
  },
  {
    href: "https://www.youtube.com/watch?v=nyB7MlYo1v0",
    title: "Create bespoke styles with CSS Modules",
    description: 'codedamn: Learn how you can make use of CSS modules in Next.js and work with them.'
  },
]} />

## Building pages

We use NextJS and Vercel as our front-end stack, which makes it possible to work with
react on the server and in the browser. 

<figure>
  <blockquote>
Next.js: The React Framework

Next.js has the best-in-class "Developer Experience" and many built-in features; a sample of them are:

+ An intuitive page-based routing system (with support for dynamic routes)
+ Pre-rendering, both static generation (SSG) and server-side rendering (SSR) are supported on a per-page basis
+ Automatic code splitting for faster page loads
+ Client-side routing with optimized prefetching
+ Built-in CSS and Sass support, and support for any CSS-in-JS library
+ Development environment with Fast Refresh support
+ API routes to build API endpoints with Serverless Functions

Next.js is used in tens of thousands of production-facing websites and web applications,
including many of the world's largest brands.
  </blockquote>
  <figcaption>Learn more about Next.js at <a href="https://next.js.org/learn/basics/create-Next.js-app" target="_blank" rel="noopener noreferrer">next.js.org</a></figcaption>
</figure>

Now that you know more about Next.js, have a look at these guides to point you in
the right direction for further work.

<LinkList links={[
  {
    href: "https://nextjs.org/docs/routing/introduction",
    title: "File system routing with Next.js",
    description: 'Learn the basics of Next.js\'s file-based routing system'
  },
  {
    href: "https://nextjs.org/docs/api-routes/introduction",
    title: "Handle API requests with Next.js",
    description: 'Learn how to create a simple API in Next.js'
  },
  {
    href: "https://github.com/vinissimus/next-translate#use-translations-in-your-pages",
    title: "Adding text localisations with Next-Translate",
    description: 'Quickly set up translation keys for your page or component'
  },
  {
    href: "https://github.com/garmeeh/next-seo#add-seo-to-page",
    title: "Adding SEO Metadata with NextSEO",
    description: 'Quickly add necessary SEO information to a page using next-seo'
  },
  {
    href: "https://next-auth.js.org/getting-started/client#usesession",
    title: "Handling authentication with Next-Auth",
    description: 'Check if the user is logged in or not and change the behaviour of a page'
  },
  {
    href: "https://www.youtube.com/watch?v=lgurVvQsOTY",
    title: "End-To-End (E2E) Testing with Cypress",
    description: 'Gleb Bahmutov talks about how you can use Cypress.io, a free open-source testing tool, to write end-to-end tests for your React apps.'
  },
  {
    href: "https://github.com/cyrilwanner/next-optimized-images/tree/canary#image-components",
    title: "Including images with Next-Optimized-Images",
    description: 'Have your assets automatically optimized using the amazing next-optimized-images plugin'
  },
]} />

## Deploying the site

Before your code makes it to production, it will have to pass tests.
We use Prettier, ESLint, StyleLint, and TypeScript to lint our code. The idea
is that it should look and feel the same no matter which developer worked on it.

Once you're code is fully linted (most issues are auto-fixed) and committed,
you will need to ensure that any Unit Tests still work, and that e2e testing
still passes. This might mean editing the tests yourself, adding new ones, or
cleaning up old tests that are no-longer relevant.

If you've been following a Test-Driven-Develoment (TDD) approach, this work should
already be done!

<Tip label="Note">
  The site can only be deployed by senior engineers, and only if <strong>all tests and checks are passing</strong>.
</Tip>

### Start coding

Pull the latest changes to your Repo
```bash
git fetch --all
git pull
```

Check-out a fresh branch with:
```bash
git checkout -B feature/feature-name
```
Before you do any work, reserve your branch by pushing it with:
```bash
git push -u origin feature/feature-name
```

Now start building your new features!
```bash
yarn dev
```

#### Preview your changes

Now that the developer environment is running, you can use the following urls to
view your code on a local test server.

- [Storybook](http://localhost:6006): `localhost:6006`
- [Next.js](http://localhost:3000): `localhost:3000`


### Commit your changes

Time to commit your changes using Git.
First, add files that have changed;
For example, `git add .` instructs git to add all changes in the current directory.
Then use the `git commit` command and the `-m` flag to quickly set a message on your commit.

```bash
git add .
git commit -m "feat: boss man gets what he wants"
```

<Tip label="Tip">
  Using a keyword like <code>feat:</code> at the start of your commit message
  is good practice, and makes it easy to identify who did what. If you're wondering what to put, take a look at <a href="https://www.conventionalcommits.org/" target="_blank">Conventional Commits</a> for some solid pointers.
</Tip>

If all is working, the test runners should now kick in to analyse your changes.
Some fixes will be applied automatically, others will require you to manually make changes.
This might include type definitions, code-style rules, or failing tests.

Once that is all taken care of and your commit has been verified, It's time to push your branch.

If you are working on the same branch as someone else, don't forget to check for changes
```bash
git fetch --all
git status
```

If there are commits available, rebase your work onto the branch by using:
```bash
git pull --rebase
```

If there were no other commits, or once the rebase has completed, it's time to finally get your code into the cloud.

```bash
git push
```

Try to push after every significant commit.
Your branch will be automatically deployed to our staging site with a unique url.

Now just repeat this process until the feature you are working on is complete and fully tested.

### Let's get this merged!

Create a pull request for the `main` branch, and await code review. 
You can do this using the [GitHub website](https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request),
[GitHub Desktop App](https://docs.github.com/en/desktop/contributing-and-collaborating-using-github-desktop/creating-an-issue-or-pull-request), 
or in [VSCode directly](https://code.visualstudio.com/blogs/2018/09/10/introducing-github-pullrequests).

When you need to move onto another task not related to this one, remember to go back to the main branch:
```bash
git fetch --all
git checkout main
git pull
```

Now you're ready to start the development process again.

### Awaiting code review

Once you've created a pull request, your code will be assigned a reviewer and looked at by the team.

If there are changes requested, they should take priority over less complete work or 
features so that we can get the work merged and keep the ball rolling.

A code review is an opportunity to discuss changes and adjustments, reflect on work done, and celebrate a 
fixed bug or a new feature! It's also a good way for the team to stay informed of changes to the site,
so we encourage you to check in on code reviews often.